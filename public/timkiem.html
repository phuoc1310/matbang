<!DOCTYPE html>

<html class="light" lang="vi">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>K·∫øt qu·∫£ t√¨m ki·∫øm | RentalSpace</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&amp;display=swap" rel="stylesheet" />
  <!-- Material Symbols -->
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <!-- Tailwind Config -->
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "primary-hover": "#106cc9",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
            "card-light": "#ffffff",
            "card-dark": "#1a2632",
            "border-light": "#e7edf3",
            "border-dark": "#2a3b4d",
          },
          fontFamily: {
            "display": ["Manrope", "sans-serif"]
          },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
        },
      },
    }
  </script>
  <script type="module" src="./asset/js/state.js"></script>
  <script type="module" src="./asset/js/api.js"></script>
  <script type="module" src="./asset/js/filter.js"></script>
  <script type="module" src="./asset/js/render.js"></script>
</head>


<body
  class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header
    class="sticky top-0 z-50 bg-card-light dark:bg-card-dark border-b border-border-light dark:border-border-dark px-4 lg:px-10 py-3 shadow-sm">
    <div class="max-w-[1440px] mx-auto flex items-center justify-between whitespace-nowrap">
      <div class="flex items-center gap-4">
        <div class="size-8 text-primary">
          <svg class="w-full h-full" fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M4 42.4379C4 42.4379 14.0962 36.0744 24 41.1692C35.0664 46.8624 44 42.2078 44 42.2078L44 7.01134C44 7.01134 35.068 11.6577 24.0031 5.96913C14.0971 0.876274 4 7.27094 4 7.27094L4 42.4379Z"
              fill="currentColor"></path>
          </svg>
        </div>
        <h2 href="Trangchu.html"
          class="hidden sm:block text-lg font-bold leading-tight tracking-[-0.015em] text-slate-900 dark:text-white">
          RentalSpace</h2>
      </div>
      <div class="flex flex-1 justify-end gap-8 items-center">
        <div class="hidden lg:flex items-center gap-9">
          <a class="text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Trang ch·ªß</a>
          <a class="text-sm font-medium leading-normal text-primary" href="#">Cho thu√™</a>
          <a class="text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Qu·∫£n l√Ω</a>
          <a class="text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Tin t·ª©c</a>
        </div>
        <div class="flex gap-2">
          <button
            class="hidden sm:flex h-10 px-4 items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm font-bold hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
            ƒêƒÉng tin
          </button>
          <button
            class="flex h-10 px-4 items-center justify-center rounded-lg bg-primary text-white text-sm font-bold hover:bg-primary-hover transition-colors">
            ƒêƒÉng nh·∫≠p
          </button>
        </div>
      </div>
    </div>
  </header>
  <!-- Main Content -->
  <main class="flex-1 max-w-[1440px] mx-auto w-full px-4 lg:px-10 py-6">
    <!-- Top Search & Breadcrumbs -->
    <div class="flex flex-col md:flex-row gap-4 justify-between items-start md:items-center mb-6">
      <nav class="text-sm text-slate-500 mb-4">
        <a href="Trangchu.html" class="hover:text-primary">Trang ch·ªß</a> /
        <span>Thu√™</span> /
        <span id="bc-region"></span> /
        <span id="breadcrumb-city" class="font-medium text-slate-900"></span>
      </nav>
      <div class="w-full md:w-[400px]">
        <div id="searchBox"
          class="relative flex items-center w-full h-10 rounded-lg focus-within:ring-2 focus-within:ring-primary/50 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark overflow-hidden">
          <div class="grid place-items-center h-full w-10 text-slate-400">
            <span class="material-symbols-outlined text-[20px]">search</span>
          </div>
          <input
            class="peer h-full w-full outline-none text-sm text-slate-700 dark:text-slate-200 pr-2 bg-transparent placeholder-slate-400"
            id="search" placeholder="T√¨m ki·∫øm theo khu v·ª±c, t√™n ƒë∆∞·ªùng..." type="text" value="" />
          <button
            class="grid place-items-center h-full w-10 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
            <span class="material-symbols-outlined text-[20px]">close</span>
          </button>
        </div>
      </div>
    </div>
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Left Sidebar Filters -->
      <aside class="w-full lg:w-[300px] flex-shrink-0 space-y-4">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-lg font-bold flex items-center gap-2">
            <span class="material-symbols-outlined text-primary">tune</span>
            B·ªô l·ªçc
          </h3>
          <button class="text-sm text-primary font-medium hover:underline">ƒê·∫∑t l·∫°i</button>
        </div>
        <div
          class="bg-card-light dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm overflow-hidden p-4 space-y-1">
          <!-- Price Range -->
          <details class="group py-2 border-b border-border-light dark:border-border-dark last:border-0" open="">
            <summary
              class="flex cursor-pointer items-center justify-between py-2 text-slate-900 dark:text-white font-bold select-none list-none">
              <span>Kho·∫£ng gi√°</span>
              <span class="material-symbols-outlined transition-transform group-open:rotate-180">expand_more</span>
            </summary>
            <div class="pt-2 pb-4 space-y-4">
              <div class="flex items-center justify-between text-sm font-medium text-slate-600 dark:text-slate-300">
                <span>0 VND</span>
                <span>20 t·ª∑ VND</span>
              </div>
              <!-- Fake Slider Visual -->
              <div class="relative h-1.5 w-full bg-slate-200 dark:bg-slate-700 rounded-full">
                <div class="absolute left-[10%] right-[30%] h-full bg-primary rounded-full"></div>
                <div
                  class="absolute left-[10%] top-1/2 -translate-y-1/2 size-4 bg-white border-2 border-primary rounded-full shadow cursor-pointer">
                </div>
                <div
                  class="absolute right-[30%] top-1/2 -translate-y-1/2 size-4 bg-white border-2 border-primary rounded-full shadow cursor-pointer">
                </div>
              </div>
              <div class="flex gap-2">
                <input id="minPrice"
                  class="w-full text-sm p-2 rounded border border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800 text-center text-slate-700 dark:text-slate-200"
                  type="text" value="0" />
                <span class="text-slate-400 self-center">-</span>
                <input id="maxPrice"
                  class="w-full text-sm p-2 rounded border border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800 text-center text-slate-700 dark:text-slate-200"
                  type="text" value="20,000,000,000" />
              </div>
            </div>
          </details>
          <!-- Area -->
          <details class="group py-2 border-b border-border-light dark:border-border-dark last:border-0" open="">
            <summary
              class="flex cursor-pointer items-center justify-between py-2 text-slate-900 dark:text-white font-bold select-none list-none">
              <span>Di·ªán t√≠ch</span>
              <span class="material-symbols-outlined transition-transform group-open:rotate-180">expand_more</span>
            </summary>
            <div class="pt-2 pb-4 space-y-2">
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input data-area="0-30"
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">D∆∞·ªõi
                  30m¬≤</span>
              </label>
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input data-area="30-50"
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">30m¬≤
                  - 50m¬≤</span>
              </label>
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input data-area="50-80"
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">50m¬≤
                  - 80m¬≤</span>
              </label>
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input data-area="80+"
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">Tr√™n
                  80m¬≤</span>
              </label>
            </div>
          </details>
          <!-- Type -->
          <details class="group py-2 border-b border-border-light dark:border-border-dark last:border-0">
            <summary
              class="flex cursor-pointer items-center justify-between py-2 text-slate-900 dark:text-white font-bold select-none list-none">
              <span>Lo·∫°i h√¨nh</span>
              <span class="material-symbols-outlined transition-transform group-open:rotate-180">expand_more</span>
            </summary>
            <div class="pt-2 pb-4 space-y-2">
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">VƒÉn
                  ph√≤ng</span>
              </label>
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">M·∫∑t
                  b·∫±ng kinh doanh</span>
              </label>
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">CƒÉn
                  h·ªô d·ªãch v·ª•</span>
              </label>
            </div>
          </details>
          <!-- Amenities -->
          <details class="group py-2 border-b border-border-light dark:border-border-dark last:border-0" open="">
            <summary
              class="flex cursor-pointer items-center justify-between py-2 text-slate-900 dark:text-white font-bold select-none list-none">
              <span>Ti·ªán √≠ch</span>
              <span class="material-symbols-outlined transition-transform group-open:rotate-180">expand_more</span>
            </summary>
            <div class="pt-2 pb-4 space-y-2">
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">Ch·ªó
                  ƒë·ªÉ xe</span>
              </label>
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">B·∫£o
                  v·ªá 24/7</span>
              </label>
              <label class="flex items-center gap-3 cursor-pointer group/item">
                <div class="relative flex items-center">
                  <input
                    class="peer size-4 appearance-none rounded border border-slate-300 dark:border-slate-600 checked:bg-primary checked:border-primary transition-all"
                    type="checkbox" />
                  <span
                    class="material-symbols-outlined absolute text-white opacity-0 peer-checked:opacity-100 text-[14px] left-[1px] pointer-events-none">check</span>
                </div>
                <span
                  class="text-sm text-slate-600 dark:text-slate-300 group-hover/item:text-primary transition-colors">Thang
                  m√°y</span>
              </label>
            </div>
          </details>
        </div>
        <button id="applyFilterBtn"
          class="w-full py-3 bg-primary text-white font-bold rounded-lg shadow-md hover:bg-primary-hover transition-colors">
          √Åp d·ª•ng b·ªô l·ªçc
        </button>
      </aside>
      <!-- Right Content Grid -->
      <div class="flex-1 min-w-0">
        <!-- Results Header -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
          <h2 class="text-2xl font-bold text-slate-900 dark:text-white">
            <span id="resultTitle" class="text-primary">K·∫øt qu·∫£</span>
          </h2>
          <div class="flex items-center gap-2">
            <span class="text-sm text-slate-500 whitespace-nowrap">S·∫Øp x·∫øp theo:</span>
            <div class="relative group">
              <button
                class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                N·ªïi b·∫≠t nh·∫•t
                <span class="material-symbols-outlined text-[20px]">expand_more</span>
              </button>
              <!-- Dropdown visual only -->
            </div>
          </div>
        </div>
        <!-- Grid -->
        <div id="listing" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        </div>

        <!-- Pagination -->
        <div class="flex justify-center mt-10">
          <div class="pagination flex items-center gap-1"></div>
        </div>

      </div>
    </div>
  </main>
  <!-- CH·ªà 1 d√≤ng n√†y ·ªü cu·ªëi body -->


</body>

<!-- D√°n ƒë√® v√†o ph·∫ßn Script cu·ªëi file timkiem.html -->
<script type="module">
  import { fetchAllData } from "./asset/js/api.js";
  import { applyFilter } from "./asset/js/filter.js";
  import { renderPage } from "./asset/js/render.js";

  document.addEventListener("DOMContentLoaded", async () => {
    console.log("üöÄ Timkiem page loaded");
    
    try {
      // 1. ƒê·ªçc URL Params
      const params = new URLSearchParams(window.location.search);
      const city = params.get("city") || "hcm";
      const keyword = params.get("keyword") || "";

      console.log("üìç Params:", { city, keyword });

      // 2. Map m√£ khu v·ª±c Ch·ª£ T·ªët (ch·ªâ ƒë·ªÉ hi·ªÉn th·ªã)
      let regionName = "TP.HCM";
      if (city === "hn") { regionName = "H√† N·ªôi"; }
      else if (city === "dn") { regionName = "ƒê√† N·∫µng"; }
      else if (city === "bd") { regionName = "B√¨nh D∆∞∆°ng"; }

      // 3. ƒêi·ªÅn d·ªØ li·ªáu v√†o UI
      const searchInput = document.getElementById("search");
      if (searchInput) searchInput.value = keyword;

      const bcRegion = document.getElementById("bc-region");
      if (bcRegion) bcRegion.textContent = regionName;

      const resultTitle = document.querySelector("h2 span.text-primary");
      if (resultTitle) resultTitle.textContent = `K·∫øt qu·∫£ t·∫°i ${regionName}`;

      // 4. Setup State
      window.__SEARCH_STATE__ = { 
        keyword: keyword,
        city: city,
        minPrice: 0,
        maxPrice: 20000000000
      };
      window.PAGE_SIZE = 9;
      window.currentPage = 1;

      // UI Loading
      const listingEl = document.getElementById("listing");
      if (listingEl) {
        listingEl.innerHTML = `
          <div class="col-span-3 text-center py-20">
            <span class="material-symbols-outlined animate-spin text-5xl text-primary">progress_activity</span>
            <p class="mt-4 text-slate-500">ƒêang t√¨m ki·∫øm m·∫∑t b·∫±ng ph√π h·ª£p...</p>
          </div>`;
      }

      // 5. G·ªçi API & Render
      console.log(`üì• Fetching data for keyword: "${keyword}"`);
      
      await fetchAllData(3, keyword);
      
      console.log("‚úÖ Raw data loaded:", window.rawData?.length, "items");
      
      // Ki·ªÉm tra d·ªØ li·ªáu
      if (window.rawData && window.rawData.length > 0) {
        console.log("üìã Sample item:", window.rawData[0]);
        console.log("üèôÔ∏è Item regionCode:", window.rawData[0].regionCode);
        
        // √Åp d·ª•ng filter
        applyFilter();
      } else {
        console.warn("‚ö†Ô∏è No data from API");
        if (listingEl) {
          listingEl.innerHTML = `
            <div class="col-span-3 text-center py-20">
              <span class="material-symbols-outlined text-5xl text-gray-400">search_off</span>
              <p class="mt-4 text-gray-600">Kh√¥ng t√¨m th·∫•y m·∫∑t b·∫±ng n√†o</p>
              <p class="text-sm text-gray-500 mt-2">H√£y th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</p>
            </div>`;
        }
      }

      // 6. G√°n s·ª± ki·ªán
      const applyBtn = document.getElementById("applyFilterBtn");
      if (applyBtn) {
        applyBtn.addEventListener("click", applyFilter);
      }

      if (searchInput) {
        searchInput.addEventListener("keyup", (e) => {
          if (e.key === "Enter") applyFilter();
        });
      }

    } catch (error) {
      console.error("‚ùå Error loading data:", error);
      const listingEl = document.getElementById("listing");
      if (listingEl) {
        listingEl.innerHTML = `
          <div class="col-span-3 text-center py-20 text-red-500">
            <span class="material-symbols-outlined text-5xl">error</span>
            <p class="mt-4 font-semibold">ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu</p>
            <p class="text-sm mt-2">${error.message}</p>
            <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-primary text-white rounded-lg">
              Th·ª≠ l·∫°i
            </button>
          </div>`;
      }
    }
  });
</script>

</html>